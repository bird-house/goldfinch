# goldfinch

Climate service processes defined through CWL.

## Setup and Development

For quick setup only with specific CWL dependencies, install the package as follows.

```shell
pip install -e .
```

Install the specific dependencies of the relevant CLI to be generated.
Otherwise, the following command can be used to install *all* dependencies across all locally defined CLI.

> [!WARNING]
> Because the CLI tool attempts to load the other Python file to identify its CWL definition from `click` decorators,
> any packages or dependencies this Python script imports has to be installed in the environment where the tool is run.

```shell
pip install -e ".[processes]"
```

## Usage Commands

All options can be obtained by running the following command:

```shell
click2cwl [-h|--help]
```

The typical command to run the CWL convertion is as follows for the desired Python CLI process:

```shell
click2cwl --process <path/to/python.py> [--output <path/to/package.cwl>] [--output-format <yaml|json>]
```

By default, the output CWL is produced as YAML on the standard output with only the `CommandLineTool` definition.
A file can be generated in YAML or JSON format by specifying the `--output` option.

An embedded `CommandLineTool` within a fully defined CWL `Workflow` graph can be generated by
specifying the `-w|--workflow` shortcut option or explicitly using the `--cwl <clt|cwl>` options.
This can also be generated as JSON or YAML, and either written to a file or standard output.

Alternatively, the Job Parameters (which would be used to call the CWL process, see below) can be generated as follows.
Note that to avoid parameter mangling between the CWL converter and the underlying CLI process arguments, they should
be distinguished by an explicit `--` separator. This can also use similar output file and format options as above.

```shell
click2cwl --process <path/to/python.py> --job [<path/to/job-params.yml>] -- [CLI ARGUMENTS ...]
```

It should then be possible to test the result as follows if everything was invoked correctly
and with all input requirements met:

```shell
cwltool <path/to/output.cwl> <path/to/job-params.yml>
```
